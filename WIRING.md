# Схема подключения ESP32-CAM

## 🔌 Распиновка ESP32-CAM (AI-Thinker)

```
                    ┌─────────────────┐
                    │   ESP32-CAM     │
                    │   AI-Thinker    │
                    ├─────────────────┤
                 ┌──┤ 5V          GND ├──┐
   Питание 5V ───┤  └─────────────────┘  ├─── GND
                 │                        │
                 │    ┌───────────┐      │
                 └────┤  OV2640   ├──────┘
                      │  Camera   │
                      └───────────┘
```

### Основные контакты

| Контакт | Назначение | Примечание |
|---------|------------|------------|
| 5V | Питание +5V | Требуется минимум 500mA, рекомендуется 1-2A |
| GND | Земля | Общий с источником питания |
| U0R | UART RX | Для прошивки: подключить к TX программатора |
| U0T | UART TX | Для прошивки: подключить к RX программатора |
| IO0 | GPIO0 | Подтянуть к GND при прошивке |
| RST | Reset | Кнопка перезагрузки (опционально) |

### GPIO для камеры (используются внутри, не трогать!)

| GPIO | Функция | GPIO | Функция |
|------|---------|------|---------|
| 0 | XCLK | 27 | SIOC |
| 26 | SIOD | 25 | VSYNC |
| 35 | Y9 | 34 | Y8 |
| 39 | Y7 | 36 | Y6 |
| 21 | Y5 | 19 | Y4 |
| 18 | Y3 | 5 | Y2 |
| 23 | HREF | 22 | PCLK |
| 32 | PWDN | - | - |

## 📱 Схема прошивки через USB-TTL

```
┌─────────────────┐              ┌─────────────────┐
│   USB-TTL       │              │   ESP32-CAM     │
│   (FTDI/CH340)  │              │   AI-Thinker    │
├─────────────────┤              ├─────────────────┤
│                 │              │                 │
│  5V (VCC)   ────┼──────────────┤ 5V              │
│                 │              │                 │
│  GND        ────┼──────┬───────┤ GND             │
│                 │      │       │                 │
│  TX         ────┼──────┼───────┤ U0R (RX)        │
│                 │      │       │                 │
│  RX         ────┼──────┼───────┤ U0T (TX)        │
│                 │      │       │                 │
└─────────────────┘      │       │ IO0 ────────┐   │
                         │       │             │   │
                         └───────┤ GND ◄───────┘   │
                                 │ (при прошивке)  │
                                 └─────────────────┘
```

### ⚠️ ВАЖНО:
1. **RX ↔ TX перепутаны!** TX программатора → RX ESP32-CAM
2. **IO0 → GND только при прошивке!** После загрузки отключите
3. **Используйте качественный кабель USB** - плохие кабели могут не давать достаточно тока
4. **Внешнее питание 5V/2A** рекомендуется для стабильной работы

## 🔋 Схема питания

### Вариант 1: От USB-TTL (только для прошивки)
```
USB-TTL 5V → ESP32-CAM 5V
USB-TTL GND → ESP32-CAM GND
```
**Ограничение:** USB порты обычно дают 500mA, может быть недостаточно.

### Вариант 2: Внешний источник питания (рекомендуется)
```
┌──────────────┐
│  Источник    │
│  5V / 1-2A   │
├──────────────┤
│  +5V     ────┼──────┬──→ ESP32-CAM 5V
│              │      │
│  GND     ────┼──────┴──→ ESP32-CAM GND
└──────────────┘
```

**Варианты источников питания:**
- USB Power Bank (5V 2A)
- Блок питания 5V 2A
- LM7805 стабилизатор от 7-12V батареи
- Step-down преобразователь от LiPo батареи

### Вариант 3: От робота (для интеграции)
```
┌─────────────────┐
│  Робот          │
│  (Arduino/ESP)  │
├─────────────────┤
│  5V      ───────┼──→ ESP32-CAM 5V
│  GND     ───────┼──→ ESP32-CAM GND
│                 │
│  GPIO_TX ───────┼──→ ESP32-CAM RX (опционально)
│  GPIO_RX ───────┼──→ ESP32-CAM TX (опционально)
└─────────────────┘
```

## 🎥 Подключение камерного модуля

```
┌────────────────────┐
│   ESP32-CAM        │
│                    │
│  ┌──────────────┐  │
│  │ FPC разъем   │  │
│  │ (24-pin)     │  │
│  └──────────────┘  │
│         ↑          │
│         │          │
│    FPC кабель      │
│         │          │
│         ↓          │
│  ┌──────────────┐  │
│  │   OV2640     │  │
│  │   Camera     │  │
│  └──────────────┘  │
└────────────────────┘
```

### ⚠️ Важно при подключении камеры:
1. **Синяя сторона кабеля** должна быть обращена к линзе камеры
2. **Контакты кабеля** смотрят вниз (к плате)
3. **Защелка разъема** должна быть поднята перед вставкой
4. **Плотно вставьте кабель** до упора
5. **Защелкните фиксатор** после установки

## 🔌 Дополнительные подключения (опционально)

### Подсветка (Flash LED)
```
ESP32-CAM GPIO4 → LED+ → Resistor → LED- → GND
```
**Внимание:** GPIO4 используется для flash LED (белый светодиод на плате)

### Кнопка Reset (удобно для отладки)
```
┌────────┐
│ Button │
└────┬───┘
     │
     ├──→ ESP32-CAM RST
     │
     └──→ GND (через конденсатор 100nF)
```

### OLED дисплей (для отображения IP)
```
┌──────────────┐        ┌────────────────┐
│ OLED Display │        │  ESP32-CAM     │
├──────────────┤        ├────────────────┤
│ VCC      ────┼────────┤ 3.3V           │
│ GND      ────┼────────┤ GND            │
│ SCL      ────┼────────┤ GPIO15 (SCL)   │
│ SDA      ────┼────────┤ GPIO14 (SDA)   │
└──────────────┘        └────────────────┘
```

### Кнопки управления предустановками
```
Button1 → GPIO12 → GND
Button2 → GPIO13 → GND
```

## 🛡️ Стабилизация питания

Для стабильной работы ESP32-CAM рекомендуется:

### 1. Конденсатор на линии питания
```
         ┌──────────┐
 5V ─────┤ 100-470µF│───→ ESP32-CAM 5V
         │ Capacitor│
 GND ────┤          │───→ ESP32-CAM GND
         └──────────┘
```

### 2. Защита от перегрузки
```
 5V ──[Предохранитель 1A]──→ ESP32-CAM 5V
```

### 3. Развязка питания
```
 5V ──[100Ω резистор]──→ ESP32-CAM 5V
    └─[100µF конденсатор]─→ GND
```

## 🔧 Процесс прошивки (пошагово)

### Шаг 1: Подключение для прошивки
1. Подключите USB-TTL к компьютеру
2. Соедините ESP32-CAM с USB-TTL:
   - 5V → 5V
   - GND → GND
   - TX (USB-TTL) → U0R (ESP32-CAM)
   - RX (USB-TTL) → U0T (ESP32-CAM)
3. **Подключите IO0 к GND** (провод или перемычка)

### Шаг 2: Прошивка
```bash
# В PlatformIO
pio run --target upload
```

### Шаг 3: Подготовка к работе
1. **Отключите IO0 от GND** (важно!)
2. Нажмите кнопку RST (или отключите/подключите питание)
3. ESP32-CAM должен запуститься в нормальном режиме

### Шаг 4: Проверка
```bash
# Откройте Serial Monitor
pio device monitor

# Вы должны увидеть:
# ESP32-CAM Line Detector Starting...
# Camera initialized
# AP IP address: 192.168.4.1
# ...
```

## 📱 Схема для использования на роботе

```
┌─────────────────────────────────────────┐
│  Line Following Robot                   │
│                                         │
│  ┌──────────────┐      ┌─────────────┐ │
│  │   ESP32-CAM  │      │  Main Board │ │
│  │              │      │  (Arduino)  │ │
│  ├──────────────┤      ├─────────────┤ │
│  │ 5V           │◄─────┤ 5V          │ │
│  │ GND          │◄─────┤ GND         │ │
│  │              │      │             │ │
│  │ TX (U0T) ────┼─────►│ RX (GPIO)   │ │ (опционально)
│  │ RX (U0R) ────┼─────►│ TX (GPIO)   │ │ (для команд)
│  └──────────────┘      └─────────────┘ │
│                                         │
│  ┌──────────────┐                      │
│  │   Motors     │                      │
│  └──────────────┘                      │
│                                         │
│  ┌──────────────┐                      │
│  │   Battery    │                      │
│  │   7.4V LiPo  │──→[Step-down 5V]──┐ │
│  └──────────────┘                   │ │
│                                     ↓ │
│                           ┌──────────┐│
│                           │ 5V Rail  ││
│                           └──────────┘│
└─────────────────────────────────────────┘
```

## 🎯 Монтаж на робота

### Рекомендации по установке:
1. **Высота:** 10-20 см над поверхностью
2. **Угол наклона:** 20-45° вниз к линии
3. **Освещение:** Избегайте бликов и теней
4. **Крепление:** Виброизоляция (резиновые прокладки)

```
         ┌─────────────┐
         │ ESP32-CAM   │
         │   ┌───┐     │
         │   │ ○ │     │ ← Камера смотрит вниз
         └───┴───┴─────┘
              ↓ 20-45°
         ___________
        /           \
       /    Линия    \
      /_______________\
```

## 🔋 Оценка потребления

| Режим | Потребление |
|-------|-------------|
| Idle (WiFi off) | ~80 mA |
| WiFi connected | ~120 mA |
| Streaming (VGA) | ~200-300 mA |
| Streaming (UXGA) | ~300-400 mA |
| Peak (с flash LED) | ~500 mA+ |

**Рекомендуемый источник:** 5V / 1-2A

## 📞 Помощь и поддержка

Если возникли проблемы:
1. Проверьте все соединения
2. Убедитесь в правильности полярности
3. Проверьте качество питания (достаточный ток)
4. Откройте Serial Monitor для диагностики
5. См. SETUP.md для решения типичных проблем

## 📚 Дополнительные ресурсы

- [ESP32-CAM Схемы](https://github.com/raphaelbs/esp32-cam-ai-thinker)
- [OV2640 Datasheet](https://www.uctronics.com/download/cam_module/OV2640DS.pdf)
- [ESP32 Pinout Reference](https://randomnerdtutorials.com/esp32-cam-ai-thinker-pinout/)

Удачи в сборке! 🔧🤖